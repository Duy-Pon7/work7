<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ScrollSpy Example</title>
  <link href="/style.css" rel="stylesheet">
  <link href="/css/custom.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/wordcloud2.js/1.1.1/wordcloud2.min.js"></script>
  <style>
    #word-cloud span {
      display: inline-block;
      margin: 5px;
      font-weight: bold;
    }
  </style>

</head>

<body>
  <div class="container mt-5">
    <h1 class="text-center">Word Cloud Generator</h1>
    
    <!-- Input Section -->
    <div class="mb-4">
      <textarea id="text-input" class="form-control" rows="6" placeholder="Nhập văn bản của bạn tại đây..."></textarea>
    </div>
  
    <!-- Nút điều chỉnh số lượng từ -->
    <div class="mb-4 text-center">
      <label for="word-count" class="form-label">Chọn số lượng từ hiển thị trên Word Cloud:</label>
      <input type="number" id="word-count" class="form-control w-50 mx-auto" value="10" min="1" max="50">
    </div>
    
    <!-- Generate Button -->
    <div class="text-center">
      <button id="generate-button" class="btn btn-primary">Tạo Word Cloud</button>
    </div>
  
    <!-- Word Cloud và Bảng -->
    <div class="row mt-5">
      <!-- Word Cloud -->
      <div class="col-md-6">
        <h4 class="text-center">Word Cloud</h4>
        <div id="word-cloud-canvas" class="border p-4" style="min-height: 300px;">
          <p class="text-muted text-center">Word Cloud sẽ hiển thị tại đây...</p>
        </div>
      </div>
  
      <!-- Bảng Từ -->
      <div class="col-md-6">
        <h4 class="text-center">Danh sách từ</h4>
        <table id="word-table" class="table table-bordered">
          <thead>
            <tr>
              <th>Từ</th>
              <th>Số lượt</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-muted text-center" colspan="2">Bảng dữ liệu sẽ hiển thị tại đây...</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  
    <!-- Nút Redraw Word Cloud -->
    <div class="text-center mt-3">
      <button id="redrawButton" class="btn btn-success">Vẽ lại Word Cloud</button>
    </div>
  </div>
  
  <script>
// Lắng nghe sự kiện nhấn nút "Tạo Word Cloud"
document.getElementById('generate-button').addEventListener('click', function () {
  // Lấy văn bản người dùng nhập vào
  const text = document.getElementById('text-input').value;
  
  if (!text.trim()) {
    alert('Vui lòng nhập văn bản!');
    return;
  }

  // Lấy số lượng từ người dùng muốn hiển thị trên Word Cloud
  const wordCount = parseInt(document.getElementById('word-count').value);

  // Tách từ và đếm tần suất
  const words = text.split(/\s+/);
  const wordFrequency = {};

  words.forEach(word => {
    word = word.toLowerCase().replace(/[^a-zA-ZÀÁÂÃÈÉÊÌÍÒÓÔÕÙÚĂĐĨŨƠàáâãèéêìíòóôõùúăđĩũơƯĂẠẢẤẦẨẪẬẮẰẲẴẶẸẺẼỀỀỂưăạảấầẩẫậắằẳẵặẹẻẽềềểỄỆỈỊỌỎỐỒỔỖỘỚỜỞỠỢỤỦỨỪễệỉịọỏốồổỗộớờởỡợụủứừửữựỳỵỷỹỲỴỶỸ ]/g, '');
    if (word) {
      wordFrequency[word] = (wordFrequency[word] || 0) + 1;
    }
  });

  // Sắp xếp các từ theo tần suất giảm dần
  const sortedWords = Object.entries(wordFrequency).sort((a, b) => b[1] - a[1]);

  // Lọc theo số lượng từ người dùng muốn hiển thị
  const selectedWords = sortedWords.slice(0, wordCount);

  // Gọi hàm vẽ lại Word Cloud và cập nhật bảng từ
  drawWordCloud(selectedWords);
});

// Hàm vẽ Word Cloud
const drawWordCloud = (words) => {
  if (WordCloud.isSupported) {
    const wordCloudCanvas = document.getElementById('word-cloud-canvas');
    const wordCloudHtml = document.getElementById('word-cloud-html');
    const elements = [wordCloudCanvas];
    const originalWords = words.map(x => ({ word: x[0], count: x[1] }));

    const options = {
      list: words,
      gridSize: 10,
      weightFactor: 8,
      fontFamily: "sans-serif",
      color: 'random-dark',
      rotateRatio: 0,
      rotationSteps: 2,
      shape: "circle",
      ellipticity: 0.6,
      shrinkToFit: true,
      minSize: 6,
      classes: 'word-cloud-item',
      click: (item, dimension, event) => {
        // Tìm từ gốc và hiển thị thông báo
        const originalItem = originalWords.find(x => x.word === item[0]);
        alert(`${originalItem.word}: ${originalItem.count}`);
      }
    };
    WordCloud(elements, options);

    // Thêm sự kiện nhấn vào từ cho phần HTML-based version
    wordCloudCanvas.addEventListener('wordcloudstop', function (e) {
      document.querySelectorAll('.word-cloud-item').forEach(function (element) {
        element.addEventListener('click', event => {
          const originalItem = originalWords.find(x => x.word === element.textContent);
          alert(`${originalItem.word}: ${originalItem.count}`);
        });
      });
    });

    // Cập nhật bảng từ
    const tableBody = document.getElementById('word-table').querySelector('tbody');
    tableBody.innerHTML = ''; // Xóa bảng cũ

    words.forEach(([word, frequency]) => {
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${word}</td>
        <td>${frequency}</td>
      `;
      tableBody.appendChild(row);
    });
  } else {
    console.log('WordCloud not supported');
  }
};

// Lắng nghe sự kiện vẽ lại Word Cloud
const redrawButton = document.getElementById('redrawButton');
redrawButton.addEventListener('click', function () {
  const text = document.getElementById('text-input').value;
  if (text.trim()) {
    const wordCount = parseInt(document.getElementById('word-count').value);
    const words = text.split(/\s+/);
    const wordFrequency = {};
    words.forEach(word => {
      word = word.toLowerCase().replace(/[^a-zA-ZÀÁÂÃÈÉÊÌÍÒÓÔÕÙÚĂĐĨŨƠàáâãèéêìíòóôõùúăđĩũơƯĂẠẢẤẦẨẪẬẮẰẲẴẶẸẺẼỀỀỂưăạảấầẩẫậắằẳẵặẹẻẽềềểỄỆỈỊỌỎỐỒỔỖỘỚỜỞỠỢỤỦỨỪễệỉịọỏốồổỗộớờởỡợụủứừửữựỳỵỷỹỲỴỶỸ ]/g, '');
      if (word) {
        wordFrequency[word] = (wordFrequency[word] || 0) + 1;
      }
    });

    const sortedWords = Object.entries(wordFrequency).sort((a, b) => b[1] - a[1]);
    const selectedWords = sortedWords.slice(0, wordCount);
    drawWordCloud(selectedWords);
  }
});

  </script>


</body>

</html>